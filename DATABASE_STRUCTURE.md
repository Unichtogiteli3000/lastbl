# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö "–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞"

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ **PostgreSQL** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `pgcrypto` –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- –•—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –Ω–∞ PL/pgSQL –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞—É–¥–∏—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üìä –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –¢–∞–±–ª–∏—Ü–∞ `user` (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö —Å–∏—Å—Ç–µ–º—ã

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `user_id` | SERIAL | PRIMARY KEY, NOT NULL | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `login` | VARCHAR(50) | UNIQUE, NOT NULL | –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) |
| `password_hash` | TEXT | NOT NULL | –•–µ—à –ø–∞—Ä–æ–ª—è (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ pgcrypto) |
| `first_name` | VARCHAR(100) | NULL | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `last_name` | VARCHAR(100) | NULL | –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `email` | VARCHAR(100) | NULL | Email –∞–¥—Ä–µ—Å |
| `avatar_url` | TEXT | NULL | URL –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `is_admin` | BOOLEAN | DEFAULT FALSE | –§–ª–∞–≥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ |
| `is_active` | BOOLEAN | DEFAULT TRUE | –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| `updated_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `user_id`
- UNIQUE –Ω–∞ `login`

**–¢—Ä–∏–≥–≥–µ—Ä—ã**:
- `update_user_updated_at` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç `updated_at` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
- `audit_users_trigger` - –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ INSERT, UPDATE, DELETE –≤ `audit_log`

---

### 2. –¢–∞–±–ª–∏—Ü–∞ `genres` (–ñ–∞–Ω—Ä—ã)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤ (–æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `genre_id` | SERIAL | PRIMARY KEY, NOT NULL | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∂–∞–Ω—Ä–∞ |
| `name` | VARCHAR(100) | UNIQUE, NOT NULL | –ù–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞ (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ) |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `genre_id`
- UNIQUE –Ω–∞ `name`

**–°–≤—è–∑–∏**:
- –°–≤—è–∑–∞–Ω–∞ —Å `tracks` —á–µ—Ä–µ–∑ `genre_id` (ON DELETE RESTRICT)
- –°–≤—è–∑–∞–Ω–∞ —Å `user_favorite_genres` —á–µ—Ä–µ–∑ `genre_id` (ON DELETE CASCADE)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ñ–∞–Ω—Ä—ã –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∂–∞–Ω—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç—Ä–µ–∫–∏ —Å —ç—Ç–∏–º –∂–∞–Ω—Ä–æ–º (RESTRICT)

---

### 3. –¢–∞–±–ª–∏—Ü–∞ `artists` (–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è—Ö (–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `artist_id` | SERIAL | PRIMARY KEY, NOT NULL | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è |
| `user_id` | INTEGER | NOT NULL, FOREIGN KEY | –í–ª–∞–¥–µ–ª–µ—Ü –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è |
| `name` | VARCHAR(100) | NOT NULL | –ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `artist_id`
- UNIQUE –Ω–∞ `(user_id, name)` - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**:
- `user_id` ‚Üí `user(user_id)` ON DELETE CASCADE

**–°–≤—è–∑–∏**:
- –°–≤—è–∑–∞–Ω–∞ —Å `tracks` —á–µ—Ä–µ–∑ `artist_id` (ON DELETE CASCADE)
- –°–≤—è–∑–∞–Ω–∞ —Å `user_favorite_artists` —á–µ—Ä–µ–∑ `artist_id` (ON DELETE CASCADE)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Å–≤–æ–π –Ω–∞–±–æ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
- –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —É —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ —Ç—Ä–µ–∫–∏ (CASCADE)

---

### 4. –¢–∞–±–ª–∏—Ü–∞ `tracks` (–¢—Ä–µ–∫–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫–∞—Ö

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `track_id` | SERIAL | PRIMARY KEY, NOT NULL | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–µ–∫–∞ |
| `title` | VARCHAR(255) | NOT NULL | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ |
| `artist_id` | INTEGER | NOT NULL, FOREIGN KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è |
| `genre_id` | INTEGER | NOT NULL, FOREIGN KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∂–∞–Ω—Ä–∞ |
| `bpm` | INTEGER | NULL | –¢–µ–º–ø —Ç—Ä–µ–∫–∞ (—É–¥–∞—Ä–æ–≤ –≤ –º–∏–Ω—É—Ç—É) |
| `duration_sec` | INTEGER | NULL | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è |
| `user_id` | INTEGER | NOT NULL, FOREIGN KEY | –í–ª–∞–¥–µ–ª–µ—Ü —Ç—Ä–µ–∫–∞ |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `track_id`

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**:
- `artist_id` ‚Üí `artists(artist_id)` ON DELETE CASCADE
- `genre_id` ‚Üí `genres(genre_id)` ON DELETE RESTRICT
- `user_id` ‚Üí `user(user_id)` ON DELETE CASCADE

**–°–≤—è–∑–∏**:
- –°–≤—è–∑–∞–Ω–∞ —Å `collection_tracks` —á–µ—Ä–µ–∑ `track_id` (ON DELETE CASCADE)

**–¢—Ä–∏–≥–≥–µ—Ä—ã**:
- `audit_tracks_trigger` - –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ INSERT, UPDATE, DELETE –≤ `audit_log`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ö–∞–∂–¥—ã–π —Ç—Ä–µ–∫ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –¢—Ä–µ–∫ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ —Ç–æ–º—É –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ —Ç—Ä–µ–∫–∏
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ —Ç—Ä–µ–∫–∏
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∂–∞–Ω—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç—Ä–µ–∫–∏ —Å —ç—Ç–∏–º –∂–∞–Ω—Ä–æ–º

---

### 5. –¢–∞–±–ª–∏—Ü–∞ `collections` (–ö–æ–ª–ª–µ–∫—Ü–∏–∏)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π —Ç—Ä–µ–∫–æ–≤

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `collection_id` | SERIAL | PRIMARY KEY, NOT NULL | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏ |
| `user_id` | INTEGER | NOT NULL, FOREIGN KEY | –í–ª–∞–¥–µ–ª–µ—Ü –∫–æ–ª–ª–µ–∫—Ü–∏–∏ |
| `name` | VARCHAR(255) | NOT NULL | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ |
| `is_favorite` | BOOLEAN | DEFAULT FALSE | –§–ª–∞–≥ "–õ—é–±–∏–º—ã–µ —Ç—Ä–µ–∫–∏" |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `collection_id`

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**:
- `user_id` ‚Üí `user(user_id)` ON DELETE CASCADE

**–°–≤—è–∑–∏**:
- –°–≤—è–∑–∞–Ω–∞ —Å `collection_tracks` —á–µ—Ä–µ–∑ `collection_id` (ON DELETE CASCADE)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ö–∞–∂–¥–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å `is_favorite = TRUE` (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∏ —Å —Ç—Ä–µ–∫–∞–º–∏

---

### 6. –¢–∞–±–ª–∏—Ü–∞ `collection_tracks` (–°–≤—è–∑—å –∫–æ–ª–ª–µ–∫—Ü–∏–π –∏ —Ç—Ä–µ–∫–æ–≤)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º —Å–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ –∏ —Ç—Ä–µ–∫–∞–º–∏

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `collection_id` | INTEGER | PRIMARY KEY, FOREIGN KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏ |
| `track_id` | INTEGER | PRIMARY KEY, FOREIGN KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–µ–∫–∞ |
| `added_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `(collection_id, track_id)`

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**:
- `collection_id` ‚Üí `collections(collection_id)` ON DELETE CASCADE
- `track_id` ‚Üí `tracks(track_id)` ON DELETE CASCADE

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –°–æ—Å—Ç–∞–≤–Ω–æ–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–¥–∏–Ω —Ç—Ä–µ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö
- –û–¥–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ç—Ä–µ–∫–æ–≤
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–ª–∏ —Ç—Ä–µ–∫–∞ —É–¥–∞–ª—è—é—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–≤—è–∑–∏

---

### 7. –¢–∞–±–ª–∏—Ü–∞ `user_favorite_genres` (–õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö –ª—é–±–∏–º—ã–º–∏ –∂–∞–Ω—Ä–∞–º–∏

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `user_id` | INTEGER | PRIMARY KEY, FOREIGN KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `genre_id` | INTEGER | PRIMARY KEY, FOREIGN KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∂–∞–Ω—Ä–∞ |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `(user_id, genre_id)`

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**:
- `user_id` ‚Üí `user(user_id)` ON DELETE CASCADE
- `genre_id` ‚Üí `genres(genre_id)` ON DELETE CASCADE

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –°–æ—Å—Ç–∞–≤–Ω–æ–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—é–±–∏–º—ã—Ö –∂–∞–Ω—Ä–æ–≤
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∂–∞–Ω—Ä–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

### 8. –¢–∞–±–ª–∏—Ü–∞ `user_favorite_artists` (–õ—é–±–∏–º—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Ö –ª—é–±–∏–º—ã–º–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `user_id` | INTEGER | PRIMARY KEY, FOREIGN KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `artist_id` | INTEGER | PRIMARY KEY, FOREIGN KEY | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `(user_id, artist_id)`

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**:
- `user_id` ‚Üí `user(user_id)` ON DELETE CASCADE
- `artist_id` ‚Üí `artists(artist_id)` ON DELETE CASCADE

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –°–æ—Å—Ç–∞–≤–Ω–æ–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—é–±–∏–º—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
- –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

### 9. –¢–∞–±–ª–∏—Ü–∞ `audit_log` (–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

| –ü–æ–ª–µ | –¢–∏–ø | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `log_id` | SERIAL | PRIMARY KEY, NOT NULL | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ |
| `user_id` | INTEGER | FOREIGN KEY, NULL | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—ã–ø–æ–ª–Ω–∏–≤—à–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏—é |
| `operation_type` | VARCHAR(20) | NOT NULL | –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏: 'INSERT', 'UPDATE', 'DELETE' |
| `table_name` | VARCHAR(50) | NOT NULL | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã |
| `record_id` | INTEGER | NULL | ID –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ |
| `operation_time` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `details` | JSONB | NULL | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON |

**–ò–Ω–¥–µ–∫—Å—ã**:
- PRIMARY KEY –Ω–∞ `log_id`

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**:
- `user_id` ‚Üí `user(user_id)` ON DELETE SET NULL

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `user_id` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ NULL (—á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é)
- –î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏: `user`, `tracks`

**–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `details`**:
```json
{
  "title": "Song Name",
  "artist_id": 5,
  "genre_id": 2
}
```

---

## üîó –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–µ–π —Ç–∞–±–ª–∏—Ü

```
user (1) ‚îÄ‚îÄ< (N) artists
  ‚îÇ              ‚îÇ
  ‚îÇ              ‚îÇ
  ‚îÇ              ‚îî‚îÄ‚îÄ< (N) tracks
  ‚îÇ
  ‚îú‚îÄ‚îÄ< (N) collections ‚îÄ‚îÄ< (N) collection_tracks >‚îÄ‚îÄ (N) tracks
  ‚îÇ
  ‚îú‚îÄ‚îÄ< (N) user_favorite_genres >‚îÄ‚îÄ (N) genres
  ‚îÇ
  ‚îú‚îÄ‚îÄ< (N) user_favorite_artists >‚îÄ‚îÄ (N) artists
  ‚îÇ
  ‚îî‚îÄ‚îÄ< (N) audit_log

genres (1) ‚îÄ‚îÄ< (N) tracks
```

---

## üîê –ü—Ä–∞–≤–∏–ª–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (ON DELETE CASCADE)
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è:
  - –í—Å–µ –µ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ (`artists`)
  - –í—Å–µ –µ–≥–æ —Ç—Ä–µ–∫–∏ (`tracks`)
  - –í—Å–µ –µ–≥–æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (`collections`)
  - –í—Å–µ –µ–≥–æ –ª—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã (`user_favorite_genres`)
  - –í—Å–µ –µ–≥–æ –ª—é–±–∏–º—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ (`user_favorite_artists`)
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è:
  - –í—Å–µ –µ–≥–æ —Ç—Ä–µ–∫–∏ (`tracks`)
  - –í—Å–µ —Å–≤—è–∑–∏ –≤ `user_favorite_artists`
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è:
  - –í—Å–µ —Å–≤—è–∑–∏ –≤ `collection_tracks`
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—Ä–µ–∫–∞ —É–¥–∞–ª—è—é—Ç—Å—è:
  - –í—Å–µ —Å–≤—è–∑–∏ –≤ `collection_tracks`

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è (ON DELETE RESTRICT)
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∂–∞–Ω—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç—Ä–µ–∫–∏ —Å —ç—Ç–∏–º –∂–∞–Ω—Ä–æ–º

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NULL (ON DELETE SET NULL)
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `user_id` –≤ `audit_log` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ NULL (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏)

---

## üìù –•—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –Ω–∞ PL/pgSQL:

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `authenticate_user(login, password)` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `register_user(login, password, first_name, last_name, email)` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `get_user_by_id(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `update_user_profile(user_id, first_name, last_name, email, avatar_url)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `check_user_is_admin(user_id)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –ñ–∞–Ω—Ä—ã
- `get_all_genres()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∂–∞–Ω—Ä–æ–≤

### –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
- `get_user_artists(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `add_artist(user_id, name)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
- `update_artist(artist_id, user_id, name)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
- `delete_artist(artist_id, user_id)` - —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (—Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º —Ç—Ä–µ–∫–æ–≤)
- `get_artist_tracks_count(artist_id, user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç—Ä–µ–∫–æ–≤ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

### –¢—Ä–µ–∫–∏
- `get_user_tracks(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–µ–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `get_all_tracks_admin()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–µ–∫–æ–≤ (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
- `add_track(user_id, title, artist_id, genre_id, bpm, duration_sec)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
- `update_track(track_id, user_id, title, artist_id, genre_id, bpm, duration_sec)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
- `delete_track(track_id)` - —É–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
- `get_track_owner(track_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ç—Ä–µ–∫–∞
- `search_tracks(user_id, title, artist, genre_id, bpm, duration_sec)` - –ø–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤

### –ö–æ–ª–ª–µ–∫—Ü–∏–∏
- `get_user_collections(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `create_collection(user_id, name, is_favorite)` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `update_collection(collection_id, name, is_favorite)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `delete_collection(collection_id)` - —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `get_collection_owner(collection_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `get_collection_tracks(collection_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–µ–∫–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `add_track_to_collection(collection_id, track_id)` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
- `remove_track_from_collection(collection_id, track_id)` - —É–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

### –õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
- `get_user_favorite_genres(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ª—é–±–∏–º—ã—Ö –∂–∞–Ω—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `get_user_favorite_artists(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ª—é–±–∏–º—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- `get_all_users()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
- `get_audit_log()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üîÑ –¢—Ä–∏–≥–≥–µ—Ä—ã

### `update_user_updated_at`
- **–¢–∞–±–ª–∏—Ü–∞**: `user`
- **–°–æ–±—ã—Ç–∏–µ**: BEFORE UPDATE
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç `updated_at` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏

### `audit_tracks_trigger`
- **–¢–∞–±–ª–∏—Ü–∞**: `tracks`
- **–°–æ–±—ã—Ç–∏–µ**: AFTER INSERT, UPDATE, DELETE
- **–î–µ–π—Å—Ç–≤–∏–µ**: –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ `audit_log` —Å –¥–µ—Ç–∞–ª—è–º–∏

### `audit_users_trigger`
- **–¢–∞–±–ª–∏—Ü–∞**: `user`
- **–°–æ–±—ã—Ç–∏–µ**: AFTER INSERT, UPDATE, DELETE
- **–î–µ–π—Å—Ç–≤–∏–µ**: –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ `audit_log` —Å –¥–µ—Ç–∞–ª—è–º–∏
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ü—Ä–∏ DELETE —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `user_id = NULL` –≤ `audit_log`

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL `pgcrypto`
- –§—É–Ω–∫—Ü–∏–∏ `pgp_sym_encrypt()` –∏ `pgp_sym_decrypt()` –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64 TEXT

### –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –Ω–µ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏

---

## üìä –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ñ–∞–Ω—Ä—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
- –†–æ–∫
- –ü–æ–ø
- –î–∂–∞–∑
- –•–∏–ø-—Ö–æ–ø
- –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞
- –ö–ª–∞—Å—Å–∏–∫–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **admin** (–ª–æ–≥–∏–Ω: admin, –ø–∞—Ä–æ–ª—å: admin) - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- **user** (–ª–æ–≥–∏–Ω: user, –ø–∞—Ä–æ–ª—å: user) - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Ç–∞–±–ª–∏—Ü**: 9
- **–•—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä**: 28+
- **–¢—Ä–∏–≥–≥–µ—Ä–æ–≤**: 3
- **–í–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π**: 12
- **–ò–Ω–¥–µ–∫—Å–æ–≤**: 9 (–≤–∫–ª—é—á–∞—è PRIMARY KEY)

